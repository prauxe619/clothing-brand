{# templates/product_detail.html #}
{% extends "base.html" %}
{% block title %}{{ product.name }} | PRAUXE{% endblock %}

{% block content %}
<div id="product-details" 
     data-product-id="{{ product.id }}" 
     data-product-name="{{ product.name }}" 
     data-product-price="{{ product.price }}" 
     data-product-image="{{ url_for('static', filename='uploads/' + product.images[0].image_url) if product.images else url_for('static', filename='uploads/default.jpg') }}">
</div>

<meta name="csrf-token" content="{{ csrf_token() }}">

<div class="container mx-auto px-4 py-8">
    <div class="lg:flex lg:space-x-10">
        <div class="lg:w-1/2 mb-8 lg:mb-0">
            {# START: Image Slider Section #}
            <!-- Image Slider -->
<div class="relative w-full overflow-hidden rounded-lg shadow-lg" id="product-image-slider">
    <div class="flex transition-transform duration-300 ease-in-out" id="slider-track">
        {% for img in product.images %}
            <div class="w-full h-auto overflow-hidden flex-shrink-0">
                <img src="{{ img.image_url if img.image_url.startswith('http') else url_for('static', filename='uploads/' + img.image_url) }}"
                     alt="{{ product.name }} image {{ loop.index0 + 1 }}"
                     class="w-full h-auto object-contain transition-transform duration-500 ease-in-out hover:scale-110">
            </div>
        {% endfor %}
    </div>

    <!-- Navigation Arrows (desktop only) -->
    <button id="prev-slide" class="hidden sm:flex absolute top-1/2 left-4 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 focus:outline-none">
        <i class="fas fa-chevron-left text-gray-700"></i>
    </button>
    <button id="next-slide" class="hidden sm:flex absolute top-1/2 right-4 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md hover:bg-gray-100 focus:outline-none">
        <i class="fas fa-chevron-right text-gray-700"></i>
    </button>

    <!-- Slider dots (mobile + desktop) -->
    <div id="slider-indicators" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
        <!-- Dots will be generated by JavaScript -->
    </div>
</div>

<!-- Thumbnails (desktop only) -->
<div class="hidden sm:flex space-x-2 mt-4 overflow-x-auto">
    {% for img in product.images %}
        <img src="{{ img.image_url if img.image_url.startswith('http') else url_for('static', filename='uploads/' + img.image_url) }}"
             alt="{{ product.name }} thumbnail {{ loop.index0 + 1 }}"
             class="w-20 h-20 object-cover rounded-md cursor-pointer border-2 border-transparent hover:border-black-600 thumbnail {% if loop.index0 == 0 %}active-thumbnail border-black-600{% endif %}"
             data-slide-index="{{ loop.index0 }}">
    {% endfor %}
</div>

            {# END: Image Slider Section #}
        </div>

        <div class="lg:w-1/2">
            <h1 class="text-4xl font-bold font-playfair text-gray-900 mb-2">{{ product.name }}</h1>
            <p class="text-gray-600 text-lg mb-4">{{ product.category }} Collection</p>
            
            <div class="flex items-center mb-4">
                <p class="text-black-600 text-3xl font-bold mr-3">{{ format_price(product.price) }}</p>
            </div>
            
            <div class="mb-6">
    <p class="text-gray-700 font-semibold mb-2">
        SELECT SIZE: 
        <span id="size-chart-trigger" 
              class="text-pink-600 text-sm ml-2 cursor-pointer hover:underline"
              data-product-category="{{ product.category | lower }}">SIZE CHART ></span>
    </p>
    <div>
 

  {% if product.product_sizes %}
    <div id="size-options" class="flex flex-wrap gap-2">
  {% for ps in product.product_sizes %}
    <button type="button"
            class="size-option w-12 h-12 border rounded-md text-sm font-medium
                   flex items-center justify-center
                   hover:bg-pink-100 focus:ring-2 focus:ring-pink-500
                   {% if ps.quantity == 0 %}opacity-50 cursor-not-allowed{% endif %}"
            data-size="{{ ps.size.name }}"
            data-qty="{{ ps.quantity }}"
            {% if ps.quantity == 0 %}disabled{% endif %}>
      {{ ps.size.name }}
    </button>
  {% endfor %}
</div>


    <!-- Stock message -->
    <p id="stock-message" class="mt-2 text-sm font-medium"></p>

    <!-- Hidden input (for form submission) -->
    <input type="hidden" name="size_id" id="selected-size">
  {% else %}
    <p class="text-gray-500">No sizes available</p>
  {% endif %}
</div>




</div>
<div class="mb-6">
    <p class="text-gray-700 font-semibold mb-2">
        SELECT COLOR:
    </p>
    {% if colors %}
    <input type="hidden" id="selected-color" name="selected_color">
    <div class="flex flex-wrap gap-2">
        {% for color in colors %}
            <button type="button"
                    class="color-option w-6 h-6 sm:w-8 sm:h-8 md:w-6 md:h-6 rounded-sm border border-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black-500 transition-all duration-200"
                    style="background-color: {{ color.hex_code if color.hex_code else '#cccccc' }};"
                    data-color="{{ color.name }}"
                    title="{{ color.name }}">
            </button>
        {% endfor %}
    </div>
    <p id="color-error" class="text-red-500 text-sm mt-1 hidden">Please select a color.</p>
    {% else %}
    <p class="text-gray-500 text-sm">No specific colors listed.</p>
    {% endif %}
</div>



            <div class="mb-6">
                <label for="product-quantity" class="block text-gray-700 font-semibold mb-2">Quantity:</label>
                <div class="flex items-center space-x-3">
                    <button id="decrease-qty" class="bg-gray-200 text-gray-700 w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-300 transition">-</button>
                    <input type="number" id="product-quantity" value="1" min="1" max="{{ product.stock }}" class="w-16 text-center border border-gray-300 rounded-md py-1 focus:ring-black-500 focus:border-black-500">
                    <button id="increase-qty" class="bg-gray-200 text-gray-700 w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-300 transition">+</button>
                </div>
                {% if product.stock <= 5 and product.stock > 0 %}
                    <p class="text-red-500 text-sm mt-2">Only {{ product.stock }} left in stock!</p>
                {% elif product.stock == 0 %}
                    <p class="text-red-500 text-sm mt-2">Out of Stock</p>
                {% endif %}
            </div>

            <div class="flex space-x-3 mb-6">
    <!-- Add to Bag -->
        
    <button id="add-to-bag-btn"
        class="flex-1 bg-black text-white py-3 rounded-lg font-semibold text-lg 
               hover:bg-gray-900 active:scale-95 transition-all duration-200 
               shadow-md flex items-center justify-center gap-2
               {% if product.stock == 0 %}opacity-50 cursor-not-allowed{% endif %}"
        {% if product.stock == 0 %}disabled{% endif %}
        data-product-id="{{ product.id }}">
        <i class="fas fa-shopping-bag text-white"></i>
        <span>Add to Bag</span>
    </button>

    <!-- Wishlist -->
    <button id="add-to-wishlist-btn"
        class="flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg font-semibold text-lg 
               hover:bg-pink-50 hover:border-pink-400 hover:text-pink-600 active:scale-95 
               transition-all duration-200 shadow-md flex items-center justify-center gap-2"
        data-product-id="{{ product.id }}"
        data-initial-wishlist-status="{{ 'true' if is_in_wishlist else 'false' }}">
        <i class="fas fa-heart"></i>
        <span>Wishlist</span>
    </button>
</div>


            <div class="flex justify-center my-6 lg:hidden">
                <button id="share-product-btn" 
                        class="flex items-center space-x-2 px-6 py-3 rounded-full border border-gray-300 text-gray-700 font-semibold hover:bg-gray-100 transition shadow-sm">
                    <i class="fas fa-share text-lg"></i>
                    <span>Share</span>
                </button>
            </div>

            <div class="border-t border-b border-gray-200 py-6 mb-6">
    <p class="text-gray-800 font-semibold mb-4 flex items-center">
        <i class="fas fa-truck mr-2 text-pink-600"></i>
        Delivery Options
    </p>

    <!-- Pincode Check -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-2 space-y-2 sm:space-y-0">
        <input type="text" id="pincode-input"
            placeholder="Enter Pincode"
            maxlength="6"
            pattern="\d{6}"
            inputmode="numeric"
            class="border border-gray-300 rounded-lg px-4 py-2 w-full sm:w-44 focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition duration-200 outline-none">
        
        <button id="check-pincode-btn"
            class="bg-pink-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-pink-700 active:scale-95 transition-all duration-200">
            Check
        </button>
    </div>

    <!-- Status Message -->
    <p id="pincode-status" class="text-sm mt-2 text-gray-600"></p>

    <!-- Benefits -->
    <div class="bg-gray-100 py-3 flex justify-around items-center text-sm text-gray-700 mt-5 rounded">
    <div class="flex flex-col items-center text-center">
        <i class="fas fa-shield-alt text-lg mb-1 text-green-500"></i>
        <span>100% Original</span>
        <span class="text-xs text-gray-500">Products</span>
    </div>
    <div class="flex flex-col items-center text-center">
        <i class="fas fa-truck text-lg mb-1 text-green-500"></i>
        <span>Cash on Delivery</span>
        <span class="text-xs text-gray-500">Available</span>
    </div>
    <div class="flex flex-col items-center text-center">
        <i class="fas fa-redo-alt text-lg mb-1 text-green-500"></i>
        <span>Easy Returns</span>
        <span class="text-xs text-gray-500">7 Days</span>
    </div>
</div>

</div>

            
            <div class="product-details-container">
                <style>
                    /* General styles for the container */
                    .product-details-container {
                        border-top: 1px solid #e0e0e0;
                        padding-top: 10px;
                    }
            
                    /* Styles for each accordion item */
                    .accordion-item {
                        border-bottom: 1px solid #e0e0e0;
                    }
            
                    /* Styles for the accordion header (the clickable part) */
                    .accordion-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px 0;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 500;
                        color: #333;
                    }
            
                    /* Styles for the plus/minus icon */
                    .accordion-icon {
                        font-size: 1.2rem;
                        transition: transform 0.3s ease-in-out;
                        color: #555;
                    }
            
                    /* Rotate the icon when the panel is open */
                    .accordion-item.open .accordion-icon {
                        transform: rotate(45deg);
                    }
            
                    /* Styles for the content panel */
                    .accordion-content {
                        max-height: 0;
                        overflow: hidden;
                        transition: max-height 0.3s ease-in-out;
                        padding: 0 0 10px 0;
                    }
                    
                    /* Styles for the content when the panel is open */
                    .accordion-item.open .accordion-content {
                        max-height: 500px; /* Adjust this value as needed to fit your content */
                    }
            
                    /* Custom link style for "CHECK AVAILABILITY" */
                    .check-availability-link {
                        font-size: 0.9rem;
                        text-decoration: underline;
                        color: #555;
                    }
                </style>
            
            
                <div class="accordion-item" data-accordion-id="description">
                    <div class="accordion-header">
                        <span>DESCRIPTION & FIT</span>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>{{ product.description }}</p>
                    </div>
                </div>
            
                <div class="accordion-item" data-accordion-id="materials">
                    <div class="accordion-header">
                        <span>MATERIALS</span>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Content about materials goes here.</p>
                    </div>
                </div>
            
                <div class="accordion-item" data-accordion-id="care-guide">
                    <div class="accordion-header">
                        <span>CARE GUIDE</span>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Content about care instructions goes here.</p>
                    </div>
                </div>
            
                <div class="accordion-item" data-accordion-id="delivery">
                    <div class="accordion-header">
                        <span>DELIVERY AND PAYMENT</span>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Content about delivery and payment goes here.</p>
                    </div>
                </div>
            </div>
            </div>
    </div>

    <!-- Similar Products -->
{% if similar_products %}
<section> class="w-full px-2 sm:px-4">
    <h2 class="collection-header">SIMILAR PRODUCTS</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4 w-full">
        {% for product in similar_products %}
        <div class="product-card">
            <!-- Image + Wishlist -->
            <a href="{{ url_for('product_details', product_id=product.id) }}" class="product-image-link">
                {% if product.main_image_url %}
                    <img class="product-image" src="{{ product.main_image_url }}" alt="{{ product.name }}">
                {% else %}
                    <img class="product-image" src="https://placehold.co/400x300/E0E0E0/333333?text=No+Image" alt="{{ product.name }}">
                {% endif %}

                <button class="wishlist-button" data-id="{{ product.id }}">
                    {% if product.id in user_wishlist_ids %}
                        <i class="fas fa-heart"></i>
                    {% else %}
                        <i class="far fa-heart"></i>
                    {% endif %}
                </button>
            </a>

            <!-- Product Info -->
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price">{{ format_price(product.price) }}</div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Recently Viewed -->
{% if recent_products %}
<section>
    <h2 class="collection-header">RECENTLY VIEWED</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4 w-full">
        {% for product in recent_products %}
        <div class="product-card">
            <!-- Image + Wishlist -->
            <a href="{{ url_for('product_details', product_id=product.id) }}" class="product-image-link">
                {% if product.main_image_url %}
                    <img class="product-image" src="{{ product.main_image_url }}" alt="{{ product.name }}">
                {% else %}
                    <img class="product-image" src="https://placehold.co/400x300/E0E0E0/333333?text=No+Image" alt="{{ product.name }}">
                {% endif %}

                <button class="wishlist-button" data-id="{{ product.id }}">
                    {% if product.id in user_wishlist_ids %}
                        <i class="fas fa-heart"></i>
                    {% else %}
                        <i class="far fa-heart"></i>
                    {% endif %}
                </button>
            </a>

            <!-- Product Info -->
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price">{{ format_price(product.price) }}</div>
        </div>
        {% endfor %}
    </div>
</section>
<style>
 .collection-header {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    font-weight: 600;
    margin: 30px 20px 20px;
    text-align: center;
    color: #222;
    position: relative;
}
.collection-header::after {
    content: "";
    display: block;
    width: 50px;
    height: 3px;
    background-color: #000;
    margin: 6px auto 0;
}

.product-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    padding: 0 16px 40px;
    max-width: 1600px;
    margin: auto;
}
@media (max-width: 767px) {
    .product-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        padding: 0 8px 30px;
    }
    .product-image {
        height: clamp(200px, 60vw, 250px);
    }
    .product-name {
        font-size: 0.8rem;
        line-height: 1.2;
    }
    .product-price {
        font-size: 0.85rem;
    }
    .wishlist-button {
        font-size: 18px;
        padding: 4px;
    }
}
@media (max-width: 480px) {
    .collection-header {
        font-size: 1.5rem;
    }
}

.product-card {
    background: transparent;
    overflow: hidden;
    transition: transform 0.3s ease;
    text-align: center;
    display: flex;
    flex-direction: column;
}
.product-card:hover {
    transform: translateY(-4px);
}

.product-image-link {
    position: relative;
    display: block;
    width: 100%;
    overflow: hidden;
}
.product-image {
    width: 100%;
    aspect-ratio: 2/3;
    object-fit: cover;
    transition: transform 0.3s ease;
}
.product-image-link:hover .product-image {
    transform: scale(1.05);
}

.product-name {
    font-weight: 500;
    color: #333;
    margin: 6px 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 0.9rem;
    text-align: left;
}
.product-price {
    font-weight: 600;
    color: #000;
    margin-bottom: 10px;
    font-size: 0.9rem;
    text-align: left;
    font-family: 'Inter', sans-serif;
}

.wishlist-button {
    position: absolute;
    top: 8px;
    right: 8px;
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    transition: transform 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
}
.wishlist-button:hover {
    transform: scale(1.2);
}
.wishlist-button i {
    font-size: 20px;
}
.wishlist-button .fas {
    color: #ef4444;
}
.wishlist-button .far {
    color: #3a3838;
}
   
</style>


{% endif %}
<!-- Women Size Chart Modal -->
<div id="women-size-chart-modal" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white rounded-xl shadow-lg max-w-lg w-full p-6 relative">
    <button class="close-size-chart-modal absolute top-3 right-3 text-gray-500 hover:text-gray-700">✕</button>
    <h2 class="text-lg font-semibold mb-4">Women's Size Chart</h2>

    <table class="w-full text-sm border">
      <thead>
        <tr class="bg-gray-100">
          <th class="p-2 border">Size</th>
          <th class="p-2 border">Bust (in)</th>
          <th class="p-2 border">Waist (in)</th>
          <th class="p-2 border">Hips (in)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td class="p-2 border">S</td><td class="p-2 border">34</td><td class="p-2 border">28</td><td class="p-2 border">36</td></tr>
        <tr><td class="p-2 border">M</td><td class="p-2 border">36</td><td class="p-2 border">30</td><td class="p-2 border">38</td></tr>
        <tr><td class="p-2 border">L</td><td class="p-2 border">38</td><td class="p-2 border">32</td><td class="p-2 border">40</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Men Size Chart Modal -->
<div id="men-size-chart-modal" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white rounded-xl shadow-lg max-w-lg w-full p-6 relative">
    <button class="close-size-chart-modal absolute top-3 right-3 text-gray-500 hover:text-gray-700">✕</button>
    <h2 class="text-lg font-semibold mb-4">Men's Size Chart</h2>

    <table class="w-full text-sm border">
      <thead>
        <tr class="bg-gray-100">
          <th class="p-2 border">Size</th>
          <th class="p-2 border">Chest (in)</th>
          <th class="p-2 border">Waist (in)</th>
          <th class="p-2 border">Length (in)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td class="p-2 border">S</td><td class="p-2 border">36</td><td class="p-2 border">30</td><td class="p-2 border">27</td></tr>
        <tr><td class="p-2 border">M</td><td class="p-2 border">38</td><td class="p-2 border">32</td><td class="p-2 border">28</td></tr>
        <tr><td class="p-2 border">L</td><td class="p-2 border">40</td><td class="p-2 border">34</td><td class="p-2 border">29</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Share Modal -->
<div id="share-product-modal"
     class="fixed inset-0 z-[9999] hidden bg-black/50 flex items-center justify-center">
  <div class="bg-white w-[90%] max-w-md rounded-xl shadow-xl p-5 relative">
    <button id="close-share-modal"
            type="button"
            class="absolute top-3 right-3 text-gray-500 hover:text-gray-700"
            aria-label="Close">✕</button>

    <h3 class="text-lg font-semibold mb-3">Share this product</h3>

    <!-- Copyable link -->
    <div class="flex gap-2 mb-3">
      <input id="share-link-input"
             class="flex-1 border rounded px-3 py-2 text-sm"
             readonly />
      <button id="copy-link-btn"
              type="button"
              class="px-3 py-2 bg-gray-900 text-white rounded">
        Copy
      </button>
    </div>
    <div id="copy-status" class="text-green-600 text-sm mb-3 hidden">Link copied!</div>

    <!-- Optional social shortcuts (JS will auto-fill hrefs) -->
    <div class="flex items-center gap-4 text-sm">
      <a class="share-icon text-blue-600 hover:underline"
         data-share-platform="facebook" target="_blank" rel="noopener">Facebook</a>
      <a class="share-icon text-sky-500 hover:underline"
         data-share-platform="twitter" target="_blank" rel="noopener">Twitter/X</a>
      <a class="share-icon text-green-600 hover:underline"
         data-share-platform="whatsapp" target="_blank" rel="noopener">WhatsApp</a>
      <a class="share-icon text-red-600 hover:underline"
         data-share-platform="pinterest" target="_blank" rel="noopener">Pinterest</a>
      <a class="share-icon hover:underline"
         data-share-platform="email">Email</a>
    </div>
  </div>
</div>


<script src="{{ url_for('static', filename='js/product_detail.js') }}"></script>

{% endblock %}