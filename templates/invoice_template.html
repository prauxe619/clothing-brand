<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tax Invoice #{{ order.invoice_number or order.id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Custom styles to mimic PDF more closely */
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-size: 0.875rem; /* text-sm equivalent */
        }
        .invoice-table th, .invoice-table td {
            padding: 0.5rem; /* Adjust padding for table cells */
            border-color: #e5e7eb; /* gray-200 */
        }
        .invoice-table th {
            background-color: #f3f4f6; /* gray-100 */
            font-weight: 600; /* semibold */
            text-transform: uppercase;
            font-size: 0.75rem; /* text-xs */
        }
        .border-bottom-dashed {
            border-bottom: 1px dashed #d1d5db; /* gray-300 */
        }
        .text-xxs {
            font-size: 0.65rem; /* Smaller text for details */
        }
    </style>
</head>
<body class="bg-white text-gray-800">
<div class="max-w-4xl mx-auto p-8 border border-gray-200 rounded-lg shadow-sm mt-10">

    <div class="mb-6 pb-4 border-b border-gray-200">
        <h1 class="text-3xl font-bold text-center mb-4">Tax Invoice</h1>
        <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
                <p class="font-bold">Sold By: {{ company_details.name or "Your Company Name" }}</p>
                <p>Ship-from Address: {{ company_details.address_line1 or "Rectangle No. XX, Village- XXXX" }},</p>
                <p>{{ company_details.address_line2 or "District- YYYY, Tehsil- ZZZZ" }}</p>
                <p>{{ company_details.city or "Jhajjar" }}, {{ company_details.state or "Haryana" }}, India {{ company_details.pincode or "124103" }}, IN-HR</p>
                <p>GSTIN-{{ company_details.gstin or "06AAAAA0000A1Z5" }}</p>
            </div>
            <div class="text-right">
                <p>Invoice Number # <span class="font-mono">{{ order.invoice_number or "FACXXXX" ~ order.id }}</span></p>
                <p>Order ID: <span class="font-mono">{{ order.order_id }}</span></p> {# Use order.order_id from your model #}
                <p>Order Date: {{ order.created_at.strftime('%d-%m-%Y') }}</p>
                <p>Invoice Date: {{ order.invoice_date.strftime('%d-%m-%Y') if order.invoice_date else order.created_at.strftime('%d-%m-%Y') }}</p>
                <p>PAN: {{ company_details.pan or "AAAAA0000A" }}</p>
                <p>CIN: {{ company_details.cin or "U00000HR0000PTC000000" }}</p>
            </div>
        </div>
        <div class="mt-4 text-sm">
             <p>Total items: <span class="font-semibold">{{ order.total_items_count or order.items|length }}</span></p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-8 mb-6 text-sm">
        <div>
            <h3 class="text-md font-semibold mb-2">Bill To</h3>
            <div class="bg-gray-50 p-3 rounded leading-5">
                <p>{{ order.billing_address.name }}</p>
                <p>{{ order.billing_address.house_no }}, {{ order.billing_address.road }}</p>
                <p>{{ order.billing_address.area }}</p>
                <p>{{ order.billing_address.city }} {{ order.billing_address.pincode }} {{ order.billing_address.state }}</p>
                <p>Phone: {{ order.billing_address.phone }}</p>
            </div>
        </div>
        <div>
            <h3 class="text-md font-semibold mb-2">Ship To</h3>
            <div class="bg-gray-50 p-3 rounded leading-5">
                <p>{{ order.shipping_address.name }}</p>
                <p>{{ order.shipping_address.house_no }}, {{ order.shipping_address.road }}</p>
                <p>{{ order.shipping_address.area }}</p>
                <p>{{ order.shipping_address.city }} {{ order.shipping_address.pincode }} {{ order.shipping_address.state }}</p>
                <p>Phone: {{ order.shipping_address.phone }}</p>
            </div>
        </div>
    </div>

    <div class="mb-6">
        <table class="w-full text-left invoice-table border">
            <thead>
                <tr>
                    <th class="p-2">Product</th>
                    <th class="p-2 text-center">Qty</th>
                    <th class="p-2 text-right">Gross<br>Amount</th>
                    <th class="p-2 text-right">Discounts<br>/Coupons</th>
                    <th class="p-2 text-right">Taxable<br>Value</th>
                    <th class="p-2 text-right">SGST<br>/UTGST ₹</th>
                    <th class="p-2 text-right">CGST<br>₹</th>
                    <th class="p-2 text-right">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items %}
                <tr class="border-b">
                    <td class="p-2 align-top">
                        <p class="font-semibold">{{ item.name }}</p> {# Changed from item.product_name to item.name #}
                        {% if item.fsn %} <p class="text-xxs text-gray-600">FSN: {{ item.fsn }}</p>{% endif %}
                        {% if item.hsn_sac %}<p class="text-xxs text-gray-600">HSN/SAC: {{ item.hsn_sac }}</p>{% endif %}
                        {% if item.warranty %}<p class="text-xxs text-gray-600">Warranty: {{ item.warranty }}</p>{% endif %}
                        {% if item.size_name %}<p class="text-xxs text-gray-600">Size: {{ item.size_name }}</p>{% endif %} {# Use size_name #}
                        {% if item.color_name %}<p class="text-xxs text-gray-600">Color: {{ item.color_name }}</p>{% endif %} {# Use color_name #}
                        {% if item.sgst_percent or item.cgst_percent %}
                            <p class="text-xxs text-gray-600">SGST/UTGST: {{ "%.1f"|format(item.sgst_percent) }}%</p> {# Format to one decimal #}
                            <p class="text-xxs text-gray-600">CGST: {{ "%.1f"|format(item.cgst_percent) }}%</p> {# Format to one decimal #}
                        {% endif %}
                    </td>
                    <td class="p-2 text-center align-top">{{ item.quantity }}</td>
                    <td class="p-2 text-right align-top">₹{{ "%.2f"|format(item.gross_amount) }}</td>
                    <td class="p-2 text-right align-top">₹{{ "%.2f"|format(item.discount_amount) }}</td>
                    <td class="p-2 text-right align-top">₹{{ "%.2f"|format(item.taxable_value) }}</td>
                    <td class="p-2 text-right align-top">₹{{ "%.2f"|format(item.sgst_amount) }}</td>
                    <td class="p-2 text-right align-top">₹{{ "%.2f"|format(item.cgst_amount) }}</td>
                    <td class="p-2 text-right align-top">₹{{ "%.2f"|format(item.total_amount) }}</td>
                </tr>
                {% endfor %}
                <tr class="border-b">
                    <td class="p-2 font-semibold">Shipping And Handling Charges</td>
                    <td class="p-2 text-center">1</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.shipping_gross_amount) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.shipping_discount) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.shipping_taxable_value) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.shipping_sgst) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.shipping_cgst) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.shipping_total) }}</td>
                </tr>
                <tr class="font-bold bg-gray-100">
                    <td class="p-2">Total</td>
                    <td class="p-2 text-center">{{ order.total_items_count }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.total_gross_amount) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.total_discounts) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.total_taxable_value) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.total_sgst) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.total_cgst) }}</td>
                    <td class="p-2 text-right">₹{{ "%.2f"|format(order.final_total) }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="grid grid-cols-2 gap-4 mt-8">
        <div>
            <p class="text-sm italic text-gray-600">*Keep this invoice and manufacturer box for warranty purposes.</p> 
        </div>
        <div class="text-right">
            <p class="text-lg font-bold">Grand Total</p> 
            <p class="text-3xl font-bold text-pink-600">₹{{ "%.2f"|format(order.final_total) }}</p> 
        </div>
    </div>

    <div class="mt-10 border-t border-gray-200 pt-6 text-sm">
        <p class="font-semibold">{{ company_details.name or "Your Company Name" }}</p> 
        <p class="mt-4">Authorized Signatory</p> 
        <p class="mt-6 text-gray-500 text-xs">Thank You! for shopping with us</p> 
    </div>

    <div class="mt-6 border-t border-gray-200 pt-6 text-xs text-gray-600 leading-relaxed">
        <p class="mb-2"><strong>Returns Policy:</strong> At {{ company_details.name or "Your Company Name" }} we try to deliver perfectly each and every time. But in the off chance that you need to return the item, please do so with the original Brand tag, original packing and invoice without which it will be really difficult for us to act on your request. Please help us in helping you. Terms and conditions apply.</p>
        <p class="mb-2">The goods sold as are intended for end user consumption and not for re-sale.</p>
        <p class="mb-2">Regd. office: {{ company_details.regd_office or "Your Company Regd. Office Address" }}</p> 
        <p>Contact {{ company_details.contact_entity or "Your Company Name" }}: {{ company_details.contact_phone or "000-0000000" }} | {{ company_details.website or "www.yourwebsite.com/helpcentre" }}</p> 
        <p class="mt-4 text-right">E. & O.E.</p>
        <p class="text-right">page 1 of 1</p>
    </div>

</div>
</body>
</html>