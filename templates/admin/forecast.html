<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sales Forecast</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Inter, sans-serif; margin: 20px; }
    #forecast-chart { width: 100%; height: 550px; }
    .alert { padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: 500; }
    .alert-warning { background: #fff3cd; color: #856404; }
  </style>
</head>
<body>
  <h1>ðŸ“ˆ Sales Forecast</h1>

  {% if alert %}
    <div class="alert alert-warning">{{ alert }}</div>
  {% endif %}

  {% if no_data %}
    <p class="text-gray-600">No forecast data available yet.</p>
  {% else %}
    <div id="forecast-chart"></div>

    <script>
      const dates = {{ dates | tojson }};
      const predictions = {{ predictions | tojson }};
      const lower_bounds = {{ lower_bounds | tojson }};
      const upper_bounds = {{ upper_bounds | tojson }};
      const actual_dates = {{ actual_dates | tojson }};
      const actual_sales = {{ actual_sales | tojson }};

      // Actual sales trace
      const actualTrace = {
        x: actual_dates,
        y: actual_sales,
        mode: 'lines+markers',
        name: 'Actual Sales',
        line: { color: 'green', width: 3 }
      };

      // Forecast trace
      const forecastTrace = {
        x: dates,
        y: predictions,
        mode: 'lines+markers',
        name: 'Forecast',
        line: { color: 'blue', dash: 'dot', width: 2 }
      };

      // Confidence interval (shaded area)
      const ciTrace = {
        x: [...dates, ...dates.slice().reverse()],
        y: [...upper_bounds, ...lower_bounds.slice().reverse()],
        fill: 'toself',
        fillcolor: 'rgba(135,206,250,0.2)',
        line: { color: 'transparent' },
        name: 'Confidence Interval',
        type: 'scatter'
      };

      const data = [ciTrace, actualTrace, forecastTrace];

      const layout = {
        title: 'Sales Forecast vs Actual',
        xaxis: { title: 'Date' },
        yaxis: { title: 'Sales Amount (â‚¹)' },
        legend: { orientation: 'h', y: -0.2 },
        hovermode: 'x unified'
      };

      Plotly.newPlot('forecast-chart', data, layout, {responsive: true});
    </script>
  {% endif %}
</body>
</html>
